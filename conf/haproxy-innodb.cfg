global
    log stdout format raw local0
    maxconn 2048

defaults
    mode tcp
    timeout connect 10s
    timeout client 30m
    timeout server 30m
    retries 3

# Read-Write: routes to MySQL primary (node1)
frontend mysql_rw
    bind *:6446
    default_backend mysql_primary

backend mysql_primary
    option tcpka
    option tcp-check
    server mysql_node1 mysql_node1:3306 check port 3306 inter 5s rise 2 fall 3

# Read-Only: round-robin across secondary nodes
frontend mysql_ro
    bind *:6447
    default_backend mysql_secondaries

backend mysql_secondaries
    option tcpka
    option tcp-check
    balance roundrobin
    server mysql_node2 mysql_node2:3306 check port 3306 inter 5s rise 2 fall 3
    server mysql_node3 mysql_node3:3306 check port 3306 inter 5s rise 2 fall 3

# Stats dashboard
frontend stats
    bind *:8407
    mode http
    default_backend stats_backend

backend stats_backend
    mode http
    stats enable
    stats uri /
    stats refresh 5s
    stats show-legends
    stats admin if TRUE
