# MongoDB 8.0 ReplicaSet Network
networks:
  backend_mongo8:
    driver: bridge
    ipam:
      config:
        - subnet: 10.11.0.0/24

services:
  # ðŸŸ¢ MongoDB 8 Node 1 (Primary candidate)
  mongo8_n1:
    image: mongo:8.0
    hostname: mongo8_n1
    container_name: mongo8_n1
    restart: unless-stopped
    command: mongod --replSet rs0 --bind_ip_all --port 27017
    ports:
      - "27511:27017"
    volumes:
      - mongo8_data1:/data/db
    networks:
      backend_mongo8:
        ipv4_address: 10.11.0.11

  # ðŸŸ¡ MongoDB 8 Node 2 (Secondary)
  mongo8_n2:
    image: mongo:8.0
    hostname: mongo8_n2
    container_name: mongo8_n2
    restart: unless-stopped
    command: mongod --replSet rs0 --bind_ip_all --port 27017
    ports:
      - "27512:27017"
    volumes:
      - mongo8_data2:/data/db
    depends_on:
      - mongo8_n1
    networks:
      backend_mongo8:
        ipv4_address: 10.11.0.12

  # ðŸŸ¡ MongoDB 8 Node 3 (Secondary)
  mongo8_n3:
    image: mongo:8.0
    hostname: mongo8_n3
    container_name: mongo8_n3
    restart: unless-stopped
    command: mongod --replSet rs0 --bind_ip_all --port 27017
    ports:
      - "27513:27017"
    volumes:
      - mongo8_data3:/data/db
    depends_on:
      - mongo8_n1
    networks:
      backend_mongo8:
        ipv4_address: 10.11.0.13

  # ðŸ”µ HAProxy (Connection Routing)
  haproxy_mongo8:
    image: haproxy:lts
    hostname: haproxy_mongo8
    container_name: haproxy_mongo8
    restart: unless-stopped
    ports:
      - "27200:27200"
      - "8409:8409"
    volumes:
      - ./conf/haproxy-mongo8.cfg:/usr/local/etc/haproxy/haproxy.cfg:ro
    depends_on:
      - mongo8_n1
      - mongo8_n2
      - mongo8_n3
    networks:
      backend_mongo8:
        ipv4_address: 10.11.0.20

volumes:
  mongo8_data1:
  mongo8_data2:
  mongo8_data3:
